<html>
  <head>
    <title>Mapa interactivo de España</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="./index.css" />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Poppins%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2Citalic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic&amp;subset=latin%2Clatin-ext"
    />
    <script type="text/javascript" src="lib/raphael-min.js"></script>
    <script type="text/javascript" src="lib/spain-map.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="provincesInfo.js"></script>
  </head>
  <body>
    <div id="map">
      <div id="province" class="province-info">
        <div class="title"></div>
        <div class="heading-wrapper">
          <div class="name-heading-wrapper">
            <div class="heading name-heading">Nombre</div>
          </div>
          <div class="typology-heading-wrapper">
            <div class="heading typology-heading">Tipología</div>
          </div>
          <div class="status-heading-wrapper">
            <div class="heading status-heading">Status</div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      new SpainMap({
        id: 'map',
        fillColor: '#ffffff',
        strokeColor: '#6FC0A9',
        strokeWidth: 1,
        selectedColor: '#D6EBE3',
        animationDuration: 200,
        onClick: function (province, event) {
          $('path').removeClass('fill-province');
          $(event.target).addClass('fill-province');
          // remove all children before showing new information
          $('div#province').empty();

          // append province title
          let provinceTitle = '';
          let nameSplitted = province.name.split('_');
          nameSplitted.forEach((part, index) => {
            provinceTitle += part.charAt(0).toUpperCase() + part.slice(1);
            if (index < nameSplitted.length - 1) {
              provinceTitle += ' ';
            }
          });
          // special case for illes baleares
          if (province.name === 'illes baleares') {
            provinceTitle = 'Islas Baleares';
          }
          $('div#province').append(`<div class="title">${provinceTitle}</div>`);

          // append titles again
          $('div#province').append(`<div class="heading-wrapper">
          <div class="name-heading-wrapper">
            <div class="heading name-heading">Nombre</div>
          </div>
          <div class="typology-heading-wrapper">
            <div class="heading typology-heading">Tipología</div>
          </div>
          <div class="status-heading-wrapper">
            <div class="heading status-heading">Status</div>
          </div>
        </div>`);

          // show financial help with name, typology (color), status(color)
          const clickedProvince = provincesData[province.name.replace(' ', '_')];

          clickedProvince.forEach((help, index) => {
            const helpId = province.name.replace(/ /g, '') + '-' + index + '-' + help.name.replace(/ /g, '');

            /* $('#province').append(
              `<div class="title">${
                province.name.charAt(0).toUpperCase() + province.name.slice(1)
              }</div>`
            ); */

            $('#province').append(`<div class="help-wrapper" id="${helpId}"></div>`);

            $(`.name-heading-wrapper`).append(`<div class="name">${help.name}</div>`);

            $(`.typology-heading-wrapper`).append(
              `<div class="typology" style="background-color: ${help.typology};"></div>`
            );

            $(`.status-heading-wrapper`).append(`<div class="status" style="background-color: ${help.status};"></div>`);
          });
          $('div#province').text();
          $('div#province').css('display', 'flex');
        }
        //onMouseOver: function(province, event) {
        //  console.log('Navigating through ' + province.name);
        //},
        //onMouseOut: function(province, event) {
        //  console.log('Leaving ' + province.name);
        //}
      });
    </script>
  </body>
</html>
